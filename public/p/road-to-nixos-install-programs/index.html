<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Road to NixOS: How do I install programs? | A blog by Yosua Ian Sebastian</title><meta name=keywords content="nixos,linux,100DaysToOffload"><meta name=description content="Adding zsh, Home Manager, and VS Code Remote - SSH"><meta name=author content="Yosua"><link rel=canonical href=https://darcien.dev/p/road-to-nixos-install-programs/><link crossorigin=anonymous href=/assets/css/stylesheet.7140587df96a2b1a49eb723fa7063dc0c641a6cb638f3140e8d3beb4deae4f5c.css integrity="sha256-cUBYfflqKxpJ63I/pwY9wMZBpstjjzFA6NO+tN6uT1w=" rel="preload stylesheet" as=style><link rel=icon href=https://darcien.dev/whale72.png><link rel=icon type=image/png sizes=16x16 href=https://darcien.dev/whale16.png><link rel=icon type=image/png sizes=32x32 href=https://darcien.dev/whale32.png><link rel=apple-touch-icon href=https://darcien.dev/whale57.png><link rel=mask-icon href=https://darcien.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/style.css rel="preload stylesheet" as=style><meta property="og:title" content="Road to NixOS: How do I install programs?"><meta property="og:description" content="Adding zsh, Home Manager, and VS Code Remote - SSH"><meta property="og:type" content="article"><meta property="og:url" content="https://darcien.dev/p/road-to-nixos-install-programs/"><meta property="article:section" content="p"><meta property="article:published_time" content="2023-07-08T02:14:14+07:00"><meta property="article:modified_time" content="2023-07-08T02:14:14+07:00"><meta property="og:site_name" content="A blog by Yosua Ian Sebastian"><meta name=twitter:card content="summary"><meta name=twitter:title content="Road to NixOS: How do I install programs?"><meta name=twitter:description content="Adding zsh, Home Manager, and VS Code Remote - SSH"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Ps","item":"https://darcien.dev/p/"},{"@type":"ListItem","position":2,"name":"Road to NixOS: How do I install programs?","item":"https://darcien.dev/p/road-to-nixos-install-programs/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Road to NixOS: How do I install programs?","name":"Road to NixOS: How do I install programs?","description":"Adding zsh, Home Manager, and VS Code Remote - SSH","keywords":["nixos","linux","100DaysToOffload"],"articleBody":"Okay, at this point I know that in NixOS everything is configured via /etc/nixos/configuration.nix. But what do I need to write in the config? How do I know what to write?\nFrom here on, my googlefu is being tested again.\nI want zsh Ez search, there’s wiki page for it here. It’s kinda crazy now that I think about it. I can write programs.zsh.enable = true;, rebuild, blam, I got zsh as my default.\nNext, I want to customize zsh. I was ready to copy paste my usual .zshrc, but that’s not a very Nix way to do it.\nThe Nix way would be to change the option in the config file. So how do I know what’s the avaiable options? At the time I had no idea, so I used GitHub search and try to find .nix file with zsh config for reference. That worked just fine, I succeded in porting my .zshrc to use Nix syntax.\n(Later on I learned the existance of MyNixOS but that’s story for another time.)\nNext, how do I apply the zsh config to my user only? Applying it globally is acceptable since I’m the only user. But it feels dirty since it’ll also affect root user.\nOnwards! I found out the existance of Home Manager\nUnto the Home Manager Initially I ignored Home Manager since it has a bit scary warning:\nWords of warning Unfortunately, it is quite possible to get difficult to understand errors when working with Home Manager. You should therefore be comfortable using the Nix language and the various tools in the Nix ecosystem.\nIf you are not very familiar with Nix but still want to use Home Manager then you are strongly encouraged to start with a small and very simple configuration and gradually make it more elaborate as you learn.\n…\nWell, I’m new and not familiar with Nix, let’s try it anyway, what could possibly go wrong?\nYep, I tried following the install Home Manager as NixOS module and couldn’t figure out why rebuild is failing.\nAfter a quick googling, I found this blog post that describes exactly what I want.\nThis time I followed the steps carefully and… it worked!\nIt was the release channel. I didn’t read the manual close enough and just run this:\nsudo nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager It doesn’t work because it’s the master branch release channel. While I’m at 22.11. So the weird error I’m seeing is from the release channel mismatch. Rebuild works after I added the correct release channel:\nsudo nix-channel --add https://github.com/nix-community/home-manager/archive/release-22.11.tar.gz home-manager Okay, I got per user config working. It’s time to add more packages!\nInfinite Packages and Beyond The fact that I can create separate config file for each package, have the options isolated, and config files not spread all over the places is SUPER nice. I got too used by the usual pattern where I need to read each package manual to figure out where the config file is located.\nAlso, the fact that I can declare all the global packages in the config is nice.\n{ pkgs, ... }: { environment.systemPackages = with pkgs; [ curl file htop lsof nixpkgs-fmt wget ]; } It’s not everyday I need to reinstall global packages, so usually it doesn’t matter that much. But recently I started using GitHub Codespaces at work. And since it’s a throwaway env, I need to reinstall and reconfigure the packages again. It would be nice if I have Home Manager that would install and configure everything in Codepaces, something to look into later. Specifying the needed packages in Codepsaces config doesn’t work really for packages that’s not used by the whole team since the preinstalled packages are shared.\nUsing VS Code with Remote - SSH Remote - SSH extension doesn’t work out of the box with NixOS. Trying to connect immediately will fail with remote VS Code SSH server failure.\nThankfully someone already identified the cause and shared the fix here. After applying the fix and rebuild, VS Code Remote - SSH work flawlessly.\nAdding Tailscale I love Tailscale, so I’m going to install it here too. Installing was straightforward since Tailscale provide installation manual.\nUnfortunately I’m getting high CPU usage after enabling Magic DNS in Tailscale. After reporting it here and tinkering with it, I think it’s fixed for now. Will write about in a separate post as the fix wasn’t a straightforward one.\nClosing Thoughts I can feel it, I’m back at the Linux world again. Where I’m spending hours just to get things working. I don’t know if it’s just because I’m not used to Linux, but whenever it’s Linux, configuring things and rabbit hole of errors easily devours all my free time. Some time this is fun, but doing this after working hour is a bit tiring. I need to find a good balance between this and other more relaxing hobbies.\nNext will be making Tailscale working!\nPost 18 of #100DaysToOffload.\n","wordCount":"824","inLanguage":"en","datePublished":"2023-07-08T02:14:14+07:00","dateModified":"2023-07-08T02:14:14+07:00","author":{"@type":"Person","name":"Yosua"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://darcien.dev/p/road-to-nixos-install-programs/"},"publisher":{"@type":"Organization","name":"A blog by Yosua Ian Sebastian","logo":{"@type":"ImageObject","url":"https://darcien.dev/whale72.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://darcien.dev/ accesskey=h title="Yosua Ian Sebastian (Alt + H)"><img src=https://darcien.dev/whale72.png alt aria-label=logo height=28>Yosua Ian Sebastian</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://darcien.dev/about title=about><span>about</span></a></li><li><a href=https://darcien.dev/uses title=uses><span>uses</span></a></li><li><a href=https://darcien.dev/tags title=tags><span>tags</span></a></li><li><a href=https://darcien.dev/search title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Road to NixOS: How do I install programs?</h1><div class=post-meta><span title='2023-07-08 02:14:14 +0700 WIB'>2023-07-08</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;824 words&nbsp;·&nbsp;Yosua</div></header><div class=post-content><p>Okay, at this point I know that in NixOS
everything is configured via <code>/etc/nixos/configuration.nix</code>.
But what do I need to write in the config?
How do I know what to write?</p><p>From here on, my googlefu is being tested again.</p><h2 id=i-want-zsh>I want zsh<a hidden class=anchor aria-hidden=true href=#i-want-zsh>#</a></h2><p>Ez search, there&rsquo;s wiki page for it <a href=https://nixos.wiki/wiki/Zsh>here</a>.
It&rsquo;s kinda crazy now that I think about it.
I can write <code>programs.zsh.enable = true;</code>, rebuild, blam, I got zsh as my default.</p><p>Next, I want to customize zsh.
I was ready to copy paste my usual <code>.zshrc</code>,
but that&rsquo;s not a very Nix way to do it.</p><p>The Nix way would be to change the option in the config file.
So how do I know what&rsquo;s the avaiable options?
At the time I had no idea,
so I used GitHub search and try to find .nix file with zsh config for reference.
That worked just fine, I succeded in porting my <code>.zshrc</code> to use Nix syntax.</p><p>(Later on I learned the existance of <a href=https://mynixos.com/>MyNixOS</a>
but that&rsquo;s story for another time.)</p><p>Next, how do I apply the zsh config to my user only?
Applying it globally is acceptable since I&rsquo;m the only user.
But it feels dirty since it&rsquo;ll also affect root user.</p><p>Onwards! I found out the existance of Home Manager</p><h2 id=unto-the-home-manager>Unto the Home Manager<a hidden class=anchor aria-hidden=true href=#unto-the-home-manager>#</a></h2><p>Initially I ignored Home Manager since it has a bit scary warning:</p><blockquote><h3 id=words-of-warninghttpsgithubcomnix-communityhome-managerwords-of-warning><a href=https://github.com/nix-community/home-manager#words-of-warning>Words of warning</a><a hidden class=anchor aria-hidden=true href=#words-of-warninghttpsgithubcomnix-communityhome-managerwords-of-warning>#</a></h3><p>Unfortunately, it is quite possible to get difficult to understand errors when working with Home Manager. You should therefore be comfortable using the Nix language and the various tools in the Nix ecosystem.</p><p>If you are not very familiar with Nix but still want to use Home Manager then you are strongly encouraged to start with a small and very simple configuration and gradually make it more elaborate as you learn.</p><p>&mldr;</p></blockquote><p>Well, I&rsquo;m new and not familiar with Nix,
let&rsquo;s try it anyway,
what could possibly go wrong?</p><p>Yep, I tried following the <a href=https://nix-community.github.io/home-manager/index.html#sec-install-nixos-module>install Home Manager as NixOS module</a>
and couldn&rsquo;t figure out why rebuild is failing.</p><p>After a quick googling, I found this <a href=https://tech.aufomm.com/my-nixos-journey-home-manager/>blog post</a>
that describes exactly what I want.</p><p>This time I followed the steps carefully and&mldr;
it worked!</p><p>It was the release channel.
I didn&rsquo;t read the manual close enough and just run this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>sudo nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
</span></span></code></pre></div><p>It doesn&rsquo;t work because it&rsquo;s the master branch release channel.
While I&rsquo;m at 22.11.
So the weird error I&rsquo;m seeing is from the release channel mismatch.
Rebuild works after I added the correct release channel:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>sudo nix-channel --add https://github.com/nix-community/home-manager/archive/release-22.11.tar.gz home-manager
</span></span></code></pre></div><p>Okay, I got per user config working.
It&rsquo;s time to add more packages!</p><h2 id=infinite-packages-and-beyond>Infinite Packages and Beyond<a hidden class=anchor aria-hidden=true href=#infinite-packages-and-beyond>#</a></h2><p>The fact that I can create separate config file for each package,
have the options isolated,
and config files not spread all over the places is SUPER nice.
I got too used by the usual pattern where I need to read each package
manual to figure out where the config file is located.</p><p>Also, the fact that I can declare all the global packages in the config
is nice.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl><span class=p>{</span> <span class=n>pkgs</span><span class=o>,</span> <span class=o>...</span> <span class=p>}:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>environment</span><span class=o>.</span><span class=n>systemPackages</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>curl</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span>
</span></span><span class=line><span class=cl>    <span class=n>htop</span>
</span></span><span class=line><span class=cl>    <span class=n>lsof</span>
</span></span><span class=line><span class=cl>    <span class=n>nixpkgs-fmt</span>
</span></span><span class=line><span class=cl>    <span class=n>wget</span>
</span></span><span class=line><span class=cl>  <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It&rsquo;s not everyday I need to reinstall global packages,
so usually it doesn&rsquo;t matter that much.
But recently I started using <a href=https://github.com/features/codespaces>GitHub Codespaces</a>
at work.
And since it&rsquo;s a throwaway env, I need to reinstall and reconfigure the packages again.
It would be nice if I have Home Manager that would install and configure everything in Codepaces,
something to look into later.
Specifying the needed packages in Codepsaces config doesn&rsquo;t work really for
packages that&rsquo;s not used by the whole team since the preinstalled packages
are shared.</p><h2 id=using-vs-code-with-remote---ssh>Using VS Code with Remote - SSH<a hidden class=anchor aria-hidden=true href=#using-vs-code-with-remote---ssh>#</a></h2><p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh">Remote - SSH</a>
extension doesn&rsquo;t work out of the box with NixOS.
Trying to connect immediately will fail with remote VS Code SSH server failure.</p><p>Thankfully someone already identified the cause and shared the fix <a href=https://github.com/nix-community/nixos-vscode-server>here</a>.
After applying the fix and rebuild, VS Code Remote - SSH work flawlessly.</p><h2 id=adding-tailscale>Adding Tailscale<a hidden class=anchor aria-hidden=true href=#adding-tailscale>#</a></h2><p>I love <a href=https://tailscale.com/>Tailscale</a>, so I&rsquo;m going to install it here too.
Installing was straightforward since Tailscale provide <a href=https://tailscale.com/kb/1063/install-nixos/>installation manual</a>.</p><p>Unfortunately I&rsquo;m getting high CPU usage after enabling Magic DNS in Tailscale.
After reporting it <a href=https://github.com/tailscale/tailscale/issues/8563>here</a>
and tinkering with it, I think it&rsquo;s fixed for now.
Will write about in a separate post as the fix wasn&rsquo;t a straightforward one.</p><h2 id=closing-thoughts>Closing Thoughts<a hidden class=anchor aria-hidden=true href=#closing-thoughts>#</a></h2><p>I can feel it, I&rsquo;m back at the Linux world again.
Where I&rsquo;m spending hours just to get things working.
I don&rsquo;t know if it&rsquo;s just because I&rsquo;m not used to Linux,
but whenever it&rsquo;s Linux, configuring things and
rabbit hole of errors easily devours all my free time.
Some time this is fun, but doing this after working hour is a bit tiring.
I need to find a good balance between this and other more relaxing hobbies.</p><p>Next will be making Tailscale working!</p><hr><p>Post 18 of <a href=https://100daystooffload.com/>#100DaysToOffload</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://darcien.dev/tags/nixos/>nixos</a></li><li><a href=https://darcien.dev/tags/linux/>linux</a></li><li><a href=https://darcien.dev/tags/100daystooffload/>100DaysToOffload</a></li></ul><nav class=paginav><a class=prev href=https://darcien.dev/p/systemd-cgtop-for-systemd-cpu-usage/><span class=title>« Prev</span><br><span>Q: How do I get % CPU usage of individual service in systemd?</span></a>
<a class=next href=https://darcien.dev/p/road-to-nixos-infection/><span class=title>Next »</span><br><span>Road to NixOS: The Infection</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 A blog by Yosua Ian Sebastian</span><br><span>Blog logo is <a target=_blank referrerpolicy=no-referrer rel=noopener href=https://twemoji.twitter.com/>Purple
Spouting Whale Twemoji</a> by Twitter, Inc and other contributors and is licensed under <a target=_blank referrerpolicy=no-referrer rel=noopener href=https://creativecommons.org/licenses/by/4.0/>CC-BY
4.0</a></span><div class=footer-blank>This space intentionally left blank.</div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>